"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,a,l){return a&&e(t.prototype,a),l&&e(t,l),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_DMReactComponent2=require("rufUtils/DMReactComponent"),_DMReactComponent3=_interopRequireDefault(_DMReactComponent2),_redexConnect=require("rufUtils/redex-connect"),_redexConnect2=_interopRequireDefault(_redexConnect),_http=require("rufUtils/http"),_http2=_interopRequireDefault(_http),_reactstrap=require("reactstrap"),TagSettings=function(e){function t(e,a){_classCallCheck(this,t);var l=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return l.componentState({loaded:!1,modal:!1,saving:!1}),l.store=l.context.store,l}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){var e=this;_http2.default.get("/data/tags/getBatchs").then(function(t){e.store.dispatch({type:"Add_tag_batchs",batchs:t.batchs}),e.store.dispatch({type:"Add_tag_batch_names",batchNames:t.batchNames}),e.componentState({loaded:!0})})}},{key:"saveBatch",value:function(){for(var e=this,t=this.refs.selections.value.split(/\n/),a=0;a<t.length;a++)t[a]=t[a].replace(",","");t=t.join(",");var l=this;l.componentState({saving:!0}),_http2.default.post("/data/tags/addBatch",{name:this.refs.name.value,taggable_type:this.refs.taggable_type.value,multi:this.refs.multi.checked,selections:t}).then(function(t){t.AddBatch&&(l.refs.name.value="",l.refs.taggable_type.value=0,l.refs.multi.checked=!1,l.refs.selections.value=""),e.store.dispatch({type:"Add_tag_batchs",batchs:[t.AddBatch]}),l.componentState({modal:!1,saving:!1})})}},{key:"toggle",value:function(){this.componentState({modal:!this.componentState().modal})}},{key:"render",value:function(){var e=this;return this.componentState().loaded?_react2.default.createElement("div",null,this.componentState().error?_react2.default.createElement("div",{className:"text-xs-center alert alert-danger"},this.componentState().error):"",_react2.default.createElement("div",null,_react2.default.createElement("button",{className:"pull-xs-right btn btn-primary m-b-2",onClick:this.toggle.bind(this)},"Add Tag Type")),_react2.default.createElement(_reactstrap.Modal,{isOpen:this.componentState().modal,toggle:this.toggle.bind(this)},_react2.default.createElement(_reactstrap.ModalHeader,null,"Add Tag Type"),_react2.default.createElement(_reactstrap.ModalBody,null,_react2.default.createElement("div",{className:"row form-group"},_react2.default.createElement("label",{className:"col-md-4 col-form-label"},"What would you like to tag?"),_react2.default.createElement("div",{className:"col-md-8"},_react2.default.createElement("select",{ref:"taggable_type",disabled:this.componentState().saving,className:"form-control"},this.props.tagBatchNames.map(function(e){return _react2.default.createElement("option",{value:e.slug,key:e.slug},e.name)}))),_react2.default.createElement("label",{className:"col-md-4 col-form-label"},"Name of the tag"),_react2.default.createElement("div",{className:"col-md-8"},_react2.default.createElement("input",{ref:"name",disabled:this.componentState().saving,className:"form-control",type:"text"})),_react2.default.createElement("label",{className:"col-md-4 col-form-label"},"Allow multiple tags?"),_react2.default.createElement("div",{className:"col-md-8"},_react2.default.createElement("input",{ref:"multi",disabled:this.componentState().saving,className:"",style:{height:"40px"},type:"checkbox",value:"1"})),_react2.default.createElement("label",{className:"col-md-4 col-form-label"},"What are the tags?"),_react2.default.createElement("div",{className:"col-md-8"},_react2.default.createElement("textarea",{disabled:this.componentState().saving,className:"form-control",ref:"selections",rows:"5"})),_react2.default.createElement("div",{className:"col-md-8 offset-md-4 m-t-1"},_react2.default.createElement("button",{disabled:this.componentState().saving,className:"btn btn-primary",onClick:this.saveBatch.bind(this)},"Save")))),_react2.default.createElement(_reactstrap.ModalFooter,null,_react2.default.createElement("button",{disabled:this.componentState().saving,type:"button",className:"btn btn-default",onClick:this.toggle.bind(this)},"Close"))),_react2.default.createElement("table",{className:"table"},_react2.default.createElement("thead",null,_react2.default.createElement("tr",null,_react2.default.createElement("th",null,"Type"),_react2.default.createElement("th",null,"Name"),_react2.default.createElement("th",null,"Multiple"),_react2.default.createElement("th",null,"Selections"))),_react2.default.createElement("tbody",null,Object.keys(this.props.tagBatchs).map(function(t){for(var a=e.props.tagBatchs[t],l="",n=0;n<e.props.tagBatchNames.length;n++)e.props.tagBatchNames[n].slug==a.taggable_type&&(l=e.props.tagBatchNames[n].name);return _react2.default.createElement("tr",{key:t},_react2.default.createElement("td",null,l),_react2.default.createElement("td",null,a.name),_react2.default.createElement("td",null,1==a.options.quantity?"Yes":"No"),_react2.default.createElement("td",null,a.options.selections.map(function(e){return e.name}).join(", ")))})))):_react2.default.createElement("div",{className:"text-xs-center"},_react2.default.createElement("div",{className:"fa fa-3x fa-cog fa-spin"}))}}]),t}(_DMReactComponent3.default);module.exports=(0,_redexConnect2.default)(TagSettings,{tagBatchs:"tagBatchs",tagBatchNames:"tagBatchNames",state:"localState"});