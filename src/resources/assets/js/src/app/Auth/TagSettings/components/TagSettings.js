"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_redexConnect=require("rufUtils/redex-connect"),_redexConnect2=_interopRequireDefault(_redexConnect),_http=require("rufUtils/http"),_http2=_interopRequireDefault(_http),_reactstrap=require("reactstrap"),_formInModal=require("rufUtils/modals/formInModal"),_formInModal2=_interopRequireDefault(_formInModal),TagSettings=function(e){function t(e,a){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return r.state={loaded:!1},r.store=r.context.store,r}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){var e=this;_http2.default.get("/data/tags/getBatchs").then(function(t){e.state.loaded=!0,e.store.dispatch({type:"Add_tag_batchs",batchs:t.batchs}),e.store.dispatch({type:"Add_tag_batch_names",batchNames:t.batchNames})})}},{key:"addTag",value:function(){for(var e=this.props.tagBatchNames,t=0;t<e.length;t++)e[t].id=e[t].slug;(0,_formInModal2.default)({id:"addTag",header:"What would you like to tag?",form:{fields:[{name:"taggable_type",label:"What would you like to tag?",placeHolder:"What would you like to tag?",inputType:"select",dataType:"number",values:e,errorMessage:"You must make a selection",helpMessage:"",required:!0},{name:"name",label:"Name of the tag",placeHolder:"Name of the tag",inputType:"text",dataType:"string",errorMessage:"You must enter a name",helpMessage:"",required:!0},{name:"multi",label:"Allow multiple tags",inputType:"checkbox",dataType:"boolean",trueValue:!0,falseValue:!1},{name:"selections",label:"What are the tags?",placeHolder:"What are the tags?",inputType:"textarea",dataType:"string",errorMessage:"You must enter some tags",helpMessage:"",required:!0}],button:{text:"Save",class:"btn-primary",position:"right"},labelsAboveFields:!1,submit:this.saveBatch.bind(this),clearFormAfterSubmit:!0}})}},{key:"saveBatch",value:function(e){for(var t=e.selections.split(/\n/),a=0;a<t.length;a++)t[a]=t[a].replace(",","");t=t.join(",");var r=this;return _http2.default.post("/data/tags/addBatch",{name:e.name,taggable_type:e.taggable_type,multi:e.multi,selections:t}).then(function(e){r.store.dispatch({type:"Add_tag_batchs",batchs:[e.AddBatch]}),_formInModal2.default.close("addTag")})}},{key:"render",value:function(){var e=this;return this.state.loaded?_react2.default.createElement("div",null,_react2.default.createElement("div",null,_react2.default.createElement("button",{className:"pull-xs-right btn btn-primary mb-2",onClick:this.addTag.bind(this)},"Add Tag Type")),_react2.default.createElement("table",{className:"table"},_react2.default.createElement("thead",null,_react2.default.createElement("tr",null,_react2.default.createElement("th",null,"Type"),_react2.default.createElement("th",null,"Name"),_react2.default.createElement("th",null,"Multiple"),_react2.default.createElement("th",null,"Selections"))),_react2.default.createElement("tbody",null,Object.keys(this.props.tagBatchs).map(function(t){for(var a=e.props.tagBatchs[t],r="",l=0;l<e.props.tagBatchNames.length;l++)e.props.tagBatchNames[l].slug==a.taggable_type&&(r=e.props.tagBatchNames[l].name);return _react2.default.createElement("tr",{key:t},_react2.default.createElement("td",null,r),_react2.default.createElement("td",null,a.name),_react2.default.createElement("td",null,1==a.options.quantity?"Yes":"No"),_react2.default.createElement("td",null,a.options.selections.map(function(e){return e.name}).join(", ")))})))):_react2.default.createElement("div",{className:"text-xs-center"},_react2.default.createElement("div",{className:"fa fa-3x fa-cog fa-spin"}))}}]),t}(_react2.default.Component);module.exports=(0,_redexConnect2.default)(TagSettings,{tagBatchs:"tagBatchs",tagBatchNames:"tagBatchNames",state:"localState"});