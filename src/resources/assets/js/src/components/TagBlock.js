"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_redexConnect=require("rufUtils/redex-connect"),_redexConnect2=_interopRequireDefault(_redexConnect),_http=require("rufUtils/http"),_http2=_interopRequireDefault(_http),TagBlock=function(t){function e(t,a){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,a));return r.store=a.store,r}return _inherits(e,t),_createClass(e,[{key:"componentDidMount",value:function(){var t=this;_http2.default.get("/data/tags/getBatchs?type="+this.props.type+"&id="+this.props.id).then(function(e){t.store.dispatch({type:"Add_tag_batchs_with_tags",batchs:e.batchs,taggableType:t.props.type,taggableId:t.props.id}),t.store.dispatch({type:"Add_tag_batch_names",user:e.batchNames})})}},{key:"changeTag",value:function(t){var e="batch_"+t.id,a=this.refs[e].value,r=this.props.tagBatchsWithTags[this.props.type][this.props.id][t.id];r.tags||(r.tags=[{name:""}]),r.tags[0].name=a,this.store.dispatch({type:"Add_tag_batchs_with_tags",batchs:r,taggableType:this.props.type,taggableId:this.props.id}),_http2.default.post("/data/tags/addTag",{tag:a,id:this.props.id,bid:t.id,taggable_type:t.taggable_type})}},{key:"render",value:function(){var t=this.props.id,e=this.props.type,a=this,r=this.props.tagBatchsWithTags;return r&&r[e]&&r[e][t]?_react2.default.createElement("div",null,r[this.props.type][this.props.id].map(function(t){if(t.taggable_type==e&&1==t.options.quantity){var r="";return t.tags&&t.tags[0]&&(r=t.tags[0].name),_react2.default.createElement("div",{key:t.id},_react2.default.createElement("h3",null,t.name),_react2.default.createElement("select",{className:"form-control",ref:"batch_"+t.id,value:r,onChange:a.changeTag.bind(a,t)},!r&&_react2.default.createElement("option",null),t.options.selections.map(function(t,e){return _react2.default.createElement("option",{key:e,value:t.name},t.name)})))}})):_react2.default.createElement("div",{className:"text-xs-center mb-3"},_react2.default.createElement("div",{className:"fa fa-3x fa-cog fa-spin"}))}}]),e}(_react2.default.Component);module.exports=(0,_redexConnect2.default)(TagBlock,{tagBatchsWithTags:"tagBatchsWithTags",tagBatchNames:"tagBatchNames"});